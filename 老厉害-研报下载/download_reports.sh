#!/bin/bash

# 设置代理
export http_proxy="http://proxy.sha.sap.corp:8080"
export https_proxy="http://proxy.sha.sap.corp:8080"

# 输出目录
OUTPUT_DIR="/Users/C5406917/repos/github-lewisliu007/docs/研报下载"

# 视频ID列表（从播放列表获取，排除已删除和私有视频）
VIDEO_IDS=(
"3WH1CueMwZA"
"dyJUscv7b9g"
"B6jb0mZpIH8"
"DOaIIGaFfZM"
"ik84e0iBNAU"
"k5i7XMcokhg"
"ER0H7XNS7oU"
"gMk5BklB8jc"
"1WaxkhUsu1c"
"lAjqEpIkxyw"
"EnDzVNMfH2o"
"wKpc51B5oZs"
"dUhhfz_QX_0"
"G-M0EzMUPVQ"
"LcCZwJaL2d0"
"nPox2VepgEM"
"FQVqliJeuvk"
"uvR65g_FekU"
"tBB8k84JWHk"
"PF2FVOOWx-Y"
"WLVklYPInr4"
"IL9xO8Lhp0A"
"MHgI9wbuPQ4"
"xmdsiuih3iA"
"o1Zbn3531FI"
"pJuriFU1-Cg"
"10f9wYUQGtE"
"BMxwkzWsUpo"
"ug8HNW_hu68"
"QThu6EICymE"
"weVtVAitVcg"
"qxH_N_Hn09s"
"XzW-IYZK0_8"
"AJZ9F2Jhr-c"
"3eE2CiY1RZw"
"oBIVQzugn2c"
"rP9EUjmur-Y"
"m6D_Jd9aTnY"
"p5Q5vJXXht4"
"r8Nk-9BahBk"
"KXgpjdapLao"
"qJRhGPbZ0sc"
"G9BAK0I6gIo"
"K2xxGp_Da-I"
"Xl_B5ws3LPI"
"mvVRHGOVg5w"
"gqZ0DziNVMw"
"lTK71BSdPm4"
"sfgtGvNjZfQ"
"zEAa5tWMiqU"
"3ls61YIGPgg"
"dN8RARhTulU"
"xBI6tWQkxbg"
"bm01UcPFyhE"
"F8CGUixXUhs"
"_mUJ66a1YfM"
"Viup7QI0lqk"
"hBroYWFEooE"
"ekLDaQc13ZU"
"4Kf93n7cilI"
"U-prz3yKkgc"
"Ofd9CZqX0T4"
"yGRrHX9ML_8"
"xA2xQ8Sk5II"
"VVE9Yta2vf8"
"2p1sKHTgOGg"
"ltiPs9_ZYcc"
"WorCbHVGc1Y"
"wNp-J-ZgGIY"
"eaisR3buO00"
"Eh9LZf_lck8"
"oYyNPjWRHI0"
"H1rVqtoinkQ"
"eZMQO9kvDsc"
"ETKe04PcumA"
"sakK0ysYpG0"
"EFjXxnJXXN8"
"1VTheLLw2dA"
"Xq7jb3veYhk"
"Lvn9wuRSTZQ"
"acJmB2Qdp9A"
"KFXOfzro63w"
"gnKDcuui0aQ"
"uT7p2BmvPNc"
"6mMsaP878VM"
"3LDyxxBYc8s"
"Meu3swHM-KI"
"1H_SmtXRfZ4"
"t65mAknanIk"
"eaQuXURvPpY"
"y-OkMxARPnY"
"ON2QLhzanNs"
"NMBh0dzEgh8"
"hrPtyo5z2CU"
"lwNBANyEFE0"
"sB1Jpp1iR1o"
"yQgSb7ctKwg"
"hgmfL3KVxyQ"
"lsMD-Uz2lNw"
"aSVJ96eaeqg"
"71mZkMknxOU"
"MncLFOGGklQ"
"zuRS7DNoRkA"
"z5NcDX2Z5j4"
"a4R_9vutLww"
"cR0D93PdAnY"
"_6_pN8T5dtc"
"qjQPPwII5TI"
"eRSafefl12g"
"TGffmUO0log"
"81E12-o_HsU"
"dPXzuQmEYmo"
"Sy6giztp-AQ"
"EwkxXqdWLjg"
"tIos9xeGH1Y"
"sdwhRLkNfqo"
"L9fPifrNw1k"
"raZxgRhMqVs"
"0TCc0nDwjkY"
"S7Ic-iWZJCc"
"2dILcPQaivk"
"D_LfpY_nQr4"
"ukARlaJDDUk"
"3bZV_LAPk9M"
"qjHTvWDTUaE"
"D0yH7aC6ayw"
"BoHiKOB3W5U"
"3KEj4AlM-4Y"
"gq1DrRehmg4"
"tslK7L1lelc"
"WAhyrU2frYI"
"gUWHMCTqfp4"
"dAK1FMluU90"
"yGnccHg7xCs"
"YV0IZH3KI3o"
"9Jly_O9PA3M"
"pnD6K252E3w"
"wQGjQOkKw_s"
"TDIi6AWi0M0"
"hMpV14Fj09M"
"U8KVwUXCJLE"
"8Xgli1X811E"
"Ughd6oJ0k-s"
"9Nuc7AgZmWs"
"213cGS8nXtI"
"oyaqnmSnvOw"
"bX2BYYZILl4"
"87OY9u3fXsU"
"3umUKIUPiUY"
"jrAx-i2BBpo"
"ZNTT8_edJf0"
"Q-ShcTs-yn0"
"HPSgxwfgzVQ"
"z28bcXZddrE"
"3NRv1vof85o"
"9ZQ3AP7ntBY"
"AV2VNuCin9M"
"8E2lhd29kTg"
"4Jmc-69nxQA"
"-9voviABpUI"
"KwF3RjM0s9Q"
"YF7dU5ChNQ8"
"JYUUPpUG4nE"
"VQDtx-WAZeQ"
"v9ktMymRrPI"
"n9R1AmFI7DA"
"n79x-ApVyJo"
"69p1sRYZw_c"
"wX0_UXtgs5g"
"3eDCWVaiYDI"
"r_yU3eG8jcg"
"1jW2knP5X_Y"
"VTjcbLvn6as"
"Nmh5uP2rDGs"
"dw_Dt6nOkZA"
"uR7RUQS9LGA"
"vwqaQOLSo68"
"PN3RgD0l4hU"
"CFVGvDF2BPg"
"mBzTPfBKNb0"
"csePu9EKfUI"
"U1j2px962F0"
"xWrPPSuc9Ng"
"SUZKYdXRt4s"
"825rlaxynSY"
"9OD50ccgOPI"
"PtTW14JUZkU"
"o9cUkj161fU"
"3krqt5QeMvk"
"DVEUiDNkrts"
"_meUbbvjvQI"
"MifvpOrX834"
"lXNXNLLyjEM"
"uuwOP8y7sAM"
"gyqypmyIe5Q"
"7rQ2MBsMkNk"
"DBWUUm7Q9bw"
"dpdP9uhN9Yg"
"nLVvPqgMT24"
"0IW_IzrUjYw"
"sFGuJKnIIuY"
"PYo-gDmXSxQ"
"7UWpx3nl8kk"
"xH2rXQXolkE"
"Cp8hkikPaes"
"S19Erim_kR4"
"-ljTdIQ9kmU"
"Yeivf33ADRI"
"k9223yp5a0g"
"QMuA0YL5SNg"
"Yg5zlphilUQ"
"0VCTbZ9AW9g"
"ZbZADei-ebw"
"Mx-yKz9usok"
"xqju5ok14T8"
"BMliIVEhxPU"
"fp6HMD9PcmU"
"wgn-rQKZjmg"
"wUidKaP2WFk"
"GRpVmZoPvt0"
"dTT9q7cj53Y"
"fG_IrBuqEOI"
"PPfLxDzWCjo"
"5Tmf64YvYRY"
"QRvrm2ILd7U"
"q1Bhcm1LtTM"
"56Xm3Pl_dlI"
"oNS9BxyiAiI"
"muuikpBytHY"
"frQGHyRtMk0"
)

# 存储链接的文件
LINKS_FILE="$OUTPUT_DIR/download_links.txt"
> "$LINKS_FILE"

echo "开始获取研报下载链接..."
echo "共有 ${#VIDEO_IDS[@]} 个视频需要处理"
echo ""

count=0
success=0

for video_id in "${VIDEO_IDS[@]}"; do
    ((count++))
    echo "[$count/${#VIDEO_IDS[@]}] 处理视频: $video_id"
    
    # 获取视频描述
    description=$(yt-dlp --proxy "http://proxy.sha.sap.corp:8080" --skip-download --get-description "https://www.youtube.com/watch?v=$video_id" 2>/dev/null)
    
    # 提取Google Drive链接
    drive_link=$(echo "$description" | grep -oE 'https://drive\.google\.com/[^ ]+' | head -1)
    
    if [ -n "$drive_link" ]; then
        echo "  找到链接: $drive_link"
        echo "$video_id|$drive_link" >> "$LINKS_FILE"
        ((success++))
    else
        echo "  未找到Google Drive链接"
    fi
    
    # 稍微延迟以避免请求过快
    sleep 1
done

echo ""
echo "链接获取完成！"
echo "成功获取 $success 个链接，保存在: $LINKS_FILE"